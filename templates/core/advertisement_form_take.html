{% extends '_base.html' %}

{% load static %}

{% block content %}
    

  {% block form_title %}
  <h2>Ny annons - Kontorshund erbjudes</h2>
  {% endblock form_title %}

  
  
  <form method="post" enctype="multipart/form-data" id="adForm" data-municipalities-url="{% url 'ajax_load_municipalities' %}" data-areas-url="{% url 'ajax_load_areas' %}" novalidate>
    {% csrf_token %}  

  
    <table>  
      {{ form.as_p }}
    </table>

    
    <button type="submit">Publicera annons</button>

  </form>

</body>
{% endblock content %}

{% block footer %}

  {% comment %} Imports for managing Django Autocomplete Light in form {% endcomment %}
  <script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static 'autocomplete_light/select2.css' %}" />
  <script type="text/javascript" src="{% static 'autocomplete_light/select2.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static 'autocomplete_light/vendor/select2/dist/css/select2.css' %}" />
  <script type="text/javascript" src="{% static 'autocomplete_light/vendor/select2/dist/js/select2.full.js' %}"></script>
  <script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
  {{ form.media }}



  {% comment %} Functions for handling area selectors {% endcomment %}
  <script>
      function hide_area_field() {
        const area_selector = document.getElementById('id_area');
        area_selector.style.display = 'none';
      }

  </script>


<script type="text/javascript" charset="utf-8"> 

    /* Function for handling the province -> municipality dropdown dependencies */

    $(function(){ 
        // inspect html to check id of category select dropdown.
        $(document).on('change', "select#id_province", function(){ 
            $.getJSON("/ajax/load-municipalities/",{province: $(this).val()}, function(j){ 
                 var options = '<option value="">---------</option>'; 
                 for (var i = 0; i < j.length; i++) { 
                     options += '<option value="' + j[i].id + '">' + j[i].name + '</option>'; 
                 } 
                 // inspect html to check id of subcategory select dropdown.
                 $("select#id_municipality").html(options); 

                // Reset areas field 
                 var empty_options = '<option value="">---------</option>';
                 $("select#id_area").html(empty_options);  

             }); 
         }); 
     }); 



        /* Function for handling the municipality -> areas dropdown dependencies */
        
        $(function(){ 
            // inspect html to check id of category select dropdown.
            $(document).on('change', "select#id_municipality", function(){ 
                $.getJSON("/ajax/load-areas/",{municipality: $(this).val()}, function(j){ 
                     var options = '<option value="">---------</option>'; 
                     for (var i = 0; i < j.length; i++) { 
                         options += '<option value="' + j[i].id + '">' + j[i].name + '</option>'; 
                     } 
                     // inspect html to check id of subcategory select dropdown.
                     $("select#id_area").html(options); 
                 }); 
             }); 
         }); 


     </script>
     
{% endblock footer %}







